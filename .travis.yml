language: python

python:
  - '3.5'
  - '3.6'

install:
  - python -m pip install -U pip setuptools
  - pip install -r requirements.txt
  - pip install .
  - pip list

script:
  # run unit tests
  - python setup.py test --addopts "--cov=setuptools_antlr --cov-report html"
  # build example project
  - pushd example
  - python setup.py antlr bdist_wheel
  - popd

after_success:
  - coveralls

before_deploy:
  - python setup.py bdist_wheel

deploy:
  - provider: releases
    api_key:
      secure: ofovn/kG4lk6EO3dsZZxjq0RkW6uvWWVwRwUXEmY+KtAHa3t3NDboDb7c3T+teJa+JatOWOGA4VxJucqpdbTMw9jqZRkBAFqXzoQBzs6HBgxgDFeJTmhq35rEz9yXOOdyfeSkOhGWhtRXvBNZltEZ7kkuB5i8hfHe3faPkYGQ8bx5LuoIaukVg+JGeXJz1ektHknrkjsfblxG7UgK9Wfhh9oBXCeUojvzgEhO+IfgDjDAqclLx6LNNdG+m+XMZDr9SpQ02d20oiPnEYB9I7mEQs/U5au+qosz0oVf8bA55F+dk4KzO+xSfBqvNrfre0U+I1J+oTNcfjwo9O5/NGmh5NgEy6Khq6aSbBuDCeREfLi9vaFF4GqE0Wn/yGc1fHkNDVJSeLt6tyr5TohKRGyuznUgVpb6T9lz+/fgELuncZNZxu2k/3lsor6ZzOlh1LUaW0oXeSGDY1271ZsH/jsB4MGQ2RNVv6nW+bkuuWKriIF+46Kor0dvbvFQNKI+FzKRgi6+h7Y+29tZQHQMBLbAWNHmitzCfKeOky/qoNENc1Eju7lddsfnW+ZrTp9uuUm8FTz1IeaVocblQFVx8zf+U0pcYdVVubnUbOQpxJBOXBadn01wuUDGUWzr62GJsxybJAnr30MkGuz7cbWc17JuYRt14k3wUn3kXBY/OmiIqk=
    file_glob: true
    file: "dist/*.whl"
    skip_cleanup: true
    on:
      repo: ferraith/setuptools-antlr
      tags: true
      python: '3.6'

  - provider: pypi
    user: ferraith
    password:
      secure: LHvJpBsd7V4/wkaABivPc8ZTV3Bnes7ujxoMbN7wGqU/emebV/zHGjgNSaPKgw5cxo4fpdHKd8C4urUAO9ADdfaQM8ukYLtkoamyNCaPSeYfEYTmwePJr1Nw7xf/ZAw2iUDqNhtlBTOjhl5FJSRg46pfs/PN3B36a1n0/VDtKaG+BEtst6lDZelEcWO2WgrqQi0FdNjpIAseePTQSf1mXWNUX3PsXA4bxLrSe7br65ZDGJUtlZt8IcQU9Fl6baeUBvE62K626xgt8eT9AqZa46oPqmgjI554jss7tYCGqle3bAJPQk56txzfxYAzMZdOB72+velXDKbRkg16C3WmxXyF0ceqFsNOpA5sryJFHqhzD9o52HPabe/ZZqy9EF7VRWbYe+8102Hhf5oXldI7I9KvEjtmAfJm0wjF/08BqRJJ+6Kequw7M+FL5lCXl1iq4IhM9ym/ab9YbR+M2kfTqzzu53ljl0rT0gFaYwpbmLH8Why1Vnk8+Yweds9ktKknjxzKh7ecBGv9sKVI46docrgUbfI9vEIaghhjn7nit20lsQ5PBwXM8OBRHTQ3Huv4dBC5ETrvlEqIzwsUwWaqCgWn1Gyn2RDWlDp27RTQ5BdmbJaB2PFzHokux1TWeah6T9jstW1I4kdPvsBf6ZGbOMD5MzQugVyKoSP7lu2lFCI=
    distributions: sdist bdist_wheel
    skip_cleanup: true
    skip_upload_docs: true
    on:
      repo: ferraith/setuptools-antlr
      tags: true
      python: '3.6'
